<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Daily Tech Digest</title>
        <style>
            :root {
                --sidebar-width: 350px;
                --primary-color: #4a90e2;
                --bg-color: #f4f7f6;
            }

            body,
            html {
                margin: 0;
                padding: 0;
                height: 100%;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                overflow: hidden;
            }

            .main-container {
                display: flex;
                height: 100vh;
            }

            /* 左侧日历栏 */
            .sidebar {
                width: var(--sidebar-width);
                background-color: white;
                border-right: 1px solid #ddd;
                display: flex;
                flex-direction: column;
                padding: 20px;
                box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
                z-index: 10;
            }

            /* 右侧内容区 */
            .content-area {
                flex: 1;
                background-color: var(--bg-color);
                position: relative;
            }

            #content-frame {
                width: 100%;
                height: 100%;
                border: none;
                display: block;
            }

            /* 日历样式 */
            .calendar-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }

            .calendar-grid {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
                text-align: center;
            }

            .weekday {
                font-weight: bold;
                color: #999;
                font-size: 0.8em;
                padding-bottom: 10px;
            }

            .day {
                padding: 10px 0;
                cursor: pointer;
                border-radius: 4px;
                transition: all 0.2s;
                font-size: 0.9em;
            }

            .day:hover {
                background-color: #e1f0ff;
            }

            .day.active {
                background-color: var(--primary-color) !important;
                color: white;
                font-weight: bold;
            }

            .day.today {
                border: 1px solid var(--primary-color);
                color: var(--primary-color);
            }

            .day.empty {
                cursor: default;
            }

            .btn {
                background: none;
                border: 1px solid #ddd;
                padding: 5px 10px;
                cursor: pointer;
                border-radius: 4px;
            }

            .btn:hover {
                background-color: #f0f0f0;
            }

            .current-month-display {
                font-weight: bold;
                font-size: 1.1em;
            }

            /* 隐藏/显示侧边栏样式 */
            .toggle-btn {
                padding: 5px 8px;
                font-size: 0.9em;
            }

            .sidebar {
                transition: all 0.3s ease;
                flex: 0 0 var(--sidebar-width);
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
                flex: 0 0 0;
                padding: 0 0;
                border-right: none;
                overflow: hidden;
            }

            .reveal-tab {
                position: absolute;
                left: 0;
                top: 50%;
                transform: translateY(-50%);
                z-index: 40;
                border: 1px solid #ddd;
                background: white;
                width: 34px;
                height: 56px;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 0;
                border-radius: 0 6px 6px 0;
                cursor: pointer;
                box-shadow: 2px 0 6px rgba(0, 0, 0, 0.08);
                font-size: 18px;
            }

            .reveal-tab.visible {
                display: flex;
            }

            .reveal-tab:hover {
                background: #fafafa;
            }

            .reveal-tab:focus {
                outline: 2px solid var(--primary-color);
            }

            .toast {
                position: fixed;
                left: 50%;
                bottom: 24px;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.75);
                color: #fff;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 0.9em;
                z-index: 100;
            }

            .toast.hidden {
                display: none;
            }

            /* 移动端：初始作为绝对层悬浮，方便滑出隐藏 */
            @media (max-width: 700px) {
                .sidebar {
                    position: absolute;
                    left: 0;
                    top: 0;
                    height: 100%;
                    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.08);
                }
            }
        </style>
    </head>

    <body>

        <div class="main-container">
            <!-- 左侧日历 -->
            <div class="sidebar" id="sidebar">
                <div class="calendar-header">
                    <button class="btn" onclick="changeMonth(-1)">&lt;</button>
                    <div class="current-month-display" id="monthDisplay"></div>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <button class="btn" onclick="changeMonth(1)">&gt;</button>
                        <button class="btn toggle-btn" id="toggleSidebarBtn" onclick="toggleSidebar()" title="切换侧边栏" aria-controls="sidebar" aria-expanded="true" aria-label="切换侧边栏">‹</button>
                    </div>
                </div>

                <div class="calendar-grid" id="calendarGrid">
                    <!-- 星期表头 -->
                    <div class="weekday">日</div>
                    <div class="weekday">一</div>
                    <div class="weekday">二</div>
                    <div class="weekday">三</div>
                    <div class="weekday">四</div>
                    <div class="weekday">五</div>
                    <div class="weekday">六</div>
                    <!-- 日期将由JS生成 -->
                </div>

                <div style="margin-top: 20px; font-size: 0.8em; color: #666;">
                    <p>提示：点击日期查看对应内容</p>
                    <p id="currentPathDisplay"></p>
                </div>
            </div>

            <!-- 右侧显示区域 -->
            <div class="content-area">
                <button id="revealTab" class="reveal-tab" aria-label="展开侧边栏" title="展开侧边栏" aria-controls="sidebar" tabindex="0">☰</button>
                <iframe id="content-frame" name="content-frame" src=""></iframe>
                <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
            </div>
        </div>

        <script>
            let currentDate = new Date(); // 当前显示的月份
            const today = new Date();     // 今天的实际日期

            const monthDisplay = document.getElementById('monthDisplay');
            const calendarGrid = document.getElementById('calendarGrid');
            const contentFrame = document.getElementById('content-frame');
            const currentPathDisplay = document.getElementById('currentPathDisplay');

            // 初始化日历
            function initCalendar() {
                renderCalendar();
                // 默认加载今天的页面
                loadPage(today.getFullYear(), today.getMonth() + 1, today.getDate());
            }

            function renderCalendar() {
                // 清除旧的日期（保留星期表头）
                const weekdays = document.querySelectorAll('.weekday');
                calendarGrid.innerHTML = '';
                weekdays.forEach(day => calendarGrid.appendChild(day));

                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                monthDisplay.innerText = `${year}年 ${month + 1}月`;

                // 获取当月第一天是星期几
                const firstDay = new Date(year, month, 1).getDay();
                // 获取当月最后一天
                const lastDate = new Date(year, month + 1, 0).getDate();

                // 填充空白日期
                for (let i = 0; i < firstDay; i++) {
                    const emptyDiv = document.createElement('div');
                    emptyDiv.classList.add('day', 'empty');
                    calendarGrid.appendChild(emptyDiv);
                }

                // 填充实际日期
                for (let i = 1; i <= lastDate; i++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('day');
                    dayDiv.innerText = i;

                    // 标记今天
                    if (year === today.getFullYear() && month === today.getMonth() && i === today.getDate()) {
                        dayDiv.classList.add('today');
                    }

                    // 点击事件
                    dayDiv.onclick = () => {
                        // 移除其他激活状态
                        document.querySelectorAll('.day').forEach(d => d.classList.remove('active'));
                        dayDiv.classList.add('active');
                        loadPage(year, month + 1, i);
                    };

                    calendarGrid.appendChild(dayDiv);
                }
            }

            function loadPage(year, month, day) {
                // 格式化日期：月份和日期补零 (例如: 2023/05/09.html)
                const fMonth = month.toString().padStart(2, '0');
                const fDay = day.toString().padStart(2, '0');

                // 构造路径
                const path = `${year}/${fMonth}/${fDay}.html`;

                // 更新 iframe 地址
                contentFrame.src = path;
                currentPathDisplay.innerText = `当前路径: ${path}`;

                // 错误处理 (当文件不存在时)
                contentFrame.onerror = function () {
                    console.error("无法加载页面: " + path);
                };
            }

            function changeMonth(offset) {
                currentDate.setMonth(currentDate.getMonth() + offset);
                renderCalendar();
            }

            const sidebar = document.querySelector('.sidebar');
            const toggleBtn = document.getElementById('toggleSidebarBtn');
            const revealTab = document.getElementById('revealTab');
            const toast = document.getElementById('toast');

            let tempExpandedByHover = false;
            // 当用户手动切换过一次后，避免自动响应式覆盖他们的偏好
            let userToggled = false;

            function setToggleButtonLabel(expanded) {
                if (!toggleBtn) return;
                toggleBtn.innerText = expanded ? '‹' : '›';
                toggleBtn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
            }

            // 切换侧边栏：true = 折叠, false = 展开
            function toggleSidebar(forceState) {
                if (!sidebar) return;
                let shouldCollapse;
                if (typeof forceState === 'boolean') shouldCollapse = forceState;
                else shouldCollapse = !sidebar.classList.contains('collapsed');

                if (shouldCollapse) {
                    sidebar.classList.add('collapsed');
                    setToggleButtonLabel(false);
                    if (revealTab) revealTab.classList.add('visible');
                    sidebar.setAttribute('aria-hidden', 'true');
                } else {
                    sidebar.classList.remove('collapsed');
                    setToggleButtonLabel(true);
                    if (revealTab) revealTab.classList.remove('visible');
                    sidebar.setAttribute('aria-hidden', 'false');
                }

                // 标记为用户主动操作（如果没有传参数则视为用户点击），用于响应式决策
                if (typeof forceState === 'undefined') userToggled = true;
            }

            if (revealTab) {
                revealTab.addEventListener('click', () => { toggleSidebar(false); userToggled = true; });

                // 鼠标悬停时临时展开（仅在原本折叠的情况下）
                revealTab.addEventListener('mouseenter', () => {
                    if (sidebar.classList.contains('collapsed')) {
                        tempExpandedByHover = true;
                        toggleSidebar(false);
                    }
                });
                revealTab.addEventListener('mouseleave', () => {
                    if (tempExpandedByHover) {
                        toggleSidebar(true);
                        tempExpandedByHover = false;
                    }
                });

                // 键盘支持（Enter/Space 激活）
                revealTab.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleSidebar(false);
                    }
                });
            }

            // 简单提示框
            function showToast(message, duration = 3000) {
                if (!toast) return;
                toast.innerText = message;
                toast.classList.remove('hidden');
                clearTimeout(showToast._t);
                showToast._t = setTimeout(() => toast.classList.add('hidden'), duration);
            }

            // 响应式处理：移动端自动隐藏
            function handleResponsive() {
                if (window.innerWidth <= 700) {
                    toggleSidebar(true);
                    showToast('屏幕较小，侧边栏已隐藏，点击 ☰ 展开');
                } else {
                    // 如果用户没有手动切换过，我们在大屏上保持展开
                    if (!userToggled) toggleSidebar(false);
                }
            }

            window.addEventListener('resize', () => handleResponsive());

            // 启动
            function initCalendar() {
                renderCalendar();
                // 默认加载今天的页面
                loadPage(today.getFullYear(), today.getMonth() + 1, today.getDate());
                // 初始化按钮状态
                setToggleButtonLabel(true);
                // 启动时检查响应式
                handleResponsive();
            }

            initCalendar();
        </script>

    </body>

</html>